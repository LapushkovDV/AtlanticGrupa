Procedure fillrecArray_GetDocumentList;
{
      var _npp: byte;
        _npp := 1;
    SetLimit(_recArray, 0);
    SetLimit(_recArray, 1);

    _recArray[_npp].def := coPS1_stock_APPLICATIONID        ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListAPPLICATIONID       ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListREQUESTSTATUS       ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListUUID                ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListDataEVSD            ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListSTATUS              ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListBusinessEntityGuid  ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListEnterpriseGuid      ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListTrasporttype        ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListCar                 ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListGlobalID            ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListProductName         ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListVolume              ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListKatEd               ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListDataProizv          ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListSrokGodn            ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListBatchID             ;
/*
    _recArray[_npp].def := coPS1_GetDocListLevel_2             ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListPACKINGTYPEID_2     ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListQuantity_2          ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListEAN13_2             ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListLevel_4             ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListPACKINGTYPEID_4     ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListQuantity_4          ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListEAN13_4             ; SetLimit(_recArray, GetLimit(_recArray) + 1); _npp++;
    _recArray[_npp].def := coPS1_GetDocListEAN128_4            ;
*/
}

Function getValueByNameColumn(_OleGenerateGUID : string; _nrow: longint; _columnName : string) : string;
{
  result := '';
//logstrtofile(_myLogFile,'_OleGenerateGUID='+_OleGenerateGUID+'|_nrow='+_nrow+ '|_columnName='+_columnName);
    if( getfirst ATL_RQSTAPIVALUES_Func where ((_OleGenerateGUID == ATL_RQSTAPIVALUES_Func.rqst_guid
                                                      and _nrow == ATL_RQSTAPIVALUES_Func.nrow))
                                      and ATL_RQSTAPIVALUES_Func.COLUMNNAME = _columnName
                                      ) = tsok
      {
         Result := ATL_RQSTAPIVALUES_Func.Value;
      }

}
Procedure Insert_GetDocumentList;
{
  var _i: byte;

  clearBuffer(tnATL_Vetis_DocList);
      ATL_Vetis_DocList.requestDate := Cur_date;
      ATL_Vetis_DocList.requestTime := Cur_Time;

  for(_i := 1; _I <= getLimit(_recArray); _i++)
  {
    case upcase(_recArray[_i].def) of
      Upcase(coPS1_stock_APPLICATIONID         ) : ATL_Vetis_DocList.APPLICATIONID := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListREQUESTSTATUS     ) : ATL_Vetis_DocList.REQUESTSTATUS := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListUUID              ) : ATL_Vetis_DocList.UUID               := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListDataEVSD          ) : ATL_Vetis_DocList.DataEVSD           := StrToDate(Trim(_recArray[_i].value),'YYYY-MM-DD');
      Upcase(coPS1_GetDocListSTATUS            ) : ATL_Vetis_DocList.STATUS             := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListBusinessEntityGuid) : ATL_Vetis_DocList.BusinessEntityGuid := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListEnterpriseGuid    ) : ATL_Vetis_DocList.EnterpriseGuid     := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListTrasporttype      ) : ATL_Vetis_DocList.Trasporttype       := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListCar               ) : ATL_Vetis_DocList.Car                := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListGlobalID          ) : ATL_Vetis_DocList.ProductGlobalID    := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListProductName       ) : ATL_Vetis_DocList.ProductName        := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListVolume            ) : ATL_Vetis_DocList.Volume             := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListKatEd             ) : ATL_Vetis_DocList.KatEd              := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListDataProizv        ) : ATL_Vetis_DocList.DataProizv         := strToDate(Trim(_recArray[_i].value),'YYYY-MM-DD');
      Upcase(coPS1_GetDocListSrokGodn          ) : ATL_Vetis_DocList.SrokGodn           := strToDate(Trim(_recArray[_i].value),'YYYY-MM-DD');
      Upcase(coPS1_GetDocListBatchID           ) : ATL_Vetis_DocList.BatchID            := Trim(_recArray[_i].value);
/*
      Upcase(coPS1_GetDocListLevel_2           ) : ATL_Vetis_DocList.Level_2            := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListPACKINGTYPEID_2   ) : ATL_Vetis_DocList.PACKINGTYPEID_2    := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListQuantity_2        ) : ATL_Vetis_DocList.Quantity_2         := Double(Trim(_recArray[_i].value));
      Upcase(coPS1_GetDocListEAN13_2           ) : ATL_Vetis_DocList.EAN13_2            := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListLevel_4           ) : ATL_Vetis_DocList.Level_4            := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListPACKINGTYPEID_4   ) : ATL_Vetis_DocList.PACKINGTYPEID_4    := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListQuantity_4        ) : ATL_Vetis_DocList.Quantity_4         := Double(Trim(_recArray[_i].value));
      Upcase(coPS1_GetDocListEAN13_4           ) : ATL_Vetis_DocList.EAN13_4            := Trim(_recArray[_i].value);
      Upcase(coPS1_GetDocListEAN128_4          ) : ATL_Vetis_DocList.EAN128_4           := Trim(_recArray[_i].value);
*/
    end;
  }
  var _UUID : string = ATL_Vetis_DocList.UUID;
  if getfirst ATL_Vetis_DocList2 where (( _UUID == ATL_Vetis_DocList2.UUID)) <> tsOK
   {
    Insert current ATL_Vetis_DocList;
   }
   else
    {
     getfirst ATL_Vetis_DocList where (( _UUID == ATL_Vetis_DocList.UUID));
    }


   var _OleGenerateGUID : string  = ATL_RQSTAPIVALUES.rqst_guid;
   var _nrow            : longint = ATL_RQSTAPIVALUES.nrow;

    _loop ATL_RQSTAPIVALUES_DocList where ((_OleGenerateGUID == ATL_RQSTAPIVALUES_DocList.rqst_guid
                                                   and _nrow == ATL_RQSTAPIVALUES_DocList.nrow))
                                      and inStr(coPS1_GetDocListReferencedDocumentIssueNumber,ATL_RQSTAPIVALUES_DocList.COLUMNNAME) = 1
      {
        var _postFix : String = ATL_RQSTAPIVALUES_DocList.VALUE;

         var _cATL_Vetis_DocList : comp   = ATL_Vetis_DocList.NREC;
         var _IssueNumber        : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListReferencedDocumentIssueNumber +_postFix);
         var _IssueDate          : date = strToDate(getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListReferencedDocumentissueDate +_postFix),'YYYY-MM-DD');
         var _Issuetype          : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListReferencedDocumentissuetype +_postFix);
         var _IssueRelatType     : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListReferencedDocumentissuerelationshipType +_postFix);

         if(getfirst ATL_Vetis_DocSpRefD where ((_cATL_Vetis_DocList== ATL_Vetis_DocSpRefD.cATL_Vetis_DocList))
                        and _IssueNumber    = ATL_Vetis_DocSpRefD.IssueNumber
                        and _IssueDate      = ATL_Vetis_DocSpRefD.IssueDate
                        and _Issuetype      = ATL_Vetis_DocSpRefD.Issuetype
                        and _IssueRelatType = ATL_Vetis_DocSpRefD.IssueRelatType
           ) <> tsOK
          {
           clearbuffer(#ATL_Vetis_DocSpRefD);
           ATL_Vetis_DocSpRefD.cATL_Vetis_DocList := _cATL_Vetis_DocList;
           ATL_Vetis_DocSpRefD.IssueNumber        := _IssueNumber       ;
           ATL_Vetis_DocSpRefD.IssueDate          := _IssueDate         ;
           ATL_Vetis_DocSpRefD.Issuetype          := _Issuetype         ;
           ATL_Vetis_DocSpRefD.IssueRelatType     := _IssueRelatType    ;
           insert Current ATL_Vetis_DocSpRefD;
          }
      }

    _loop ATL_RQSTAPIVALUES_DocList where ((_OleGenerateGUID == ATL_RQSTAPIVALUES_DocList.rqst_guid
                                                   and _nrow == ATL_RQSTAPIVALUES_DocList.nrow))
                               and inStr(coPS1_GetDocListDocumentstatusChangeStatus,ATL_RQSTAPIVALUES_DocList.COLUMNNAME) = 1
      {
        var _postFix : String = ATL_RQSTAPIVALUES_DocList.VALUE;
        var _cATL_Vetis_DocList : comp   = ATL_Vetis_DocList.NREC;
        var _Status             : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListDocumentstatusChangeStatus +_postFix);
        var _SpecifiedPerson    : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListDocumentstatusChangeSpecifiedPerson +_postFix);
        var _ActualDateTime     : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListDocumentstatusChangeActualDateTime +_postFix);

       if(getfirst ATL_Vetis_DocSpRefSt where ((_cATL_Vetis_DocList == ATL_Vetis_DocSpRefSt.cATL_Vetis_DocList))
                               and _Status          = ATL_Vetis_DocSpRefSt.Status
                               and _SpecifiedPerson = ATL_Vetis_DocSpRefSt.SpecifiedPerson
                               and _ActualDateTime  = ATL_Vetis_DocSpRefSt.ActualDateTime
         ) <> tsOK
       {
         clearbuffer(#ATL_Vetis_DocSpRefSt);
         ATL_Vetis_DocSpRefSt.cATL_Vetis_DocList := _cATL_Vetis_DocList;
         ATL_Vetis_DocSpRefSt.Status             := _Status            ;
         ATL_Vetis_DocSpRefSt.SpecifiedPerson    := _SpecifiedPerson   ;
         ATL_Vetis_DocSpRefSt.ActualDateTime     := _ActualDateTime    ;
         insert Current ATL_Vetis_DocSpRefSt;
       }
      }

    _loop ATL_RQSTAPIVALUES_DocList where ((_OleGenerateGUID == ATL_RQSTAPIVALUES_DocList.rqst_guid
                                                   and _nrow == ATL_RQSTAPIVALUES_DocList.nrow))
                               and inStr(coPS1_GetDocListLevel,ATL_RQSTAPIVALUES_DocList.COLUMNNAME) = 1
      {
        var _postFix : String = ATL_RQSTAPIVALUES_DocList.VALUE;
        var _cATL_Vetis_DocList : comp   = ATL_Vetis_DocList.NREC;
        var _Level : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListLevel+_postFix);
        var _PACKINGTYPEID : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListPACKINGTYPEID +_postFix);
        var _Quantity      : double = Double(getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListQuantity +_postFix));
        var _EAN13         : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListEAN13 +_postFix);
        var _EAN128        : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListEAN128 +_postFix);
        var _SSCC          : string = getValueByNameColumn(_OleGenerateGUID,_nrow,coPS1_GetDocListSSCC +_postFix);


       if(getfirst ATL_Vetis_DocSpLevel where ((_cATL_Vetis_DocList == ATL_Vetis_DocSpLevel.cATL_Vetis_DocList))
                           and _PACKINGTYPEID   = ATL_Vetis_DocSpLevel.PACKINGTYPEID
                           and _Quantity        = ATL_Vetis_DocSpLevel.Quantity
                           and _EAN13           = ATL_Vetis_DocSpLevel.EAN13
                           and _EAN128          = ATL_Vetis_DocSpLevel.EAN128
                           and _level           = ATL_Vetis_DocSpLevel.level
                           and  _SSCC           = ATL_Vetis_DocSpLevel.SSCC
         ) <> tsOK
       {
         clearbuffer(#ATL_Vetis_DocSpLevel);
          ATL_Vetis_DocSpLevel.cATL_Vetis_DocList := _cATL_Vetis_DocList;
          ATL_Vetis_DocSpLevel.level          := _level;
          ATL_Vetis_DocSpLevel.PACKINGTYPEID  := _PACKINGTYPEID;
          ATL_Vetis_DocSpLevel.Quantity       := _Quantity;
          ATL_Vetis_DocSpLevel.EAN13          := _EAN13   ;
          ATL_Vetis_DocSpLevel.EAN128         := _EAN128  ;
          ATL_Vetis_DocSpLevel.SSCC           := _SSCC;
         insert Current ATL_Vetis_DocSpLevel;
       }
      }


    // MyLog('Вставляем запись');
}  // tInsertSaldoMC
Procedure FillPS1_VetisAPI_GetDocumentList(_ExcelFileOut, _OleGenerateGUID: string; _dateBegin_dateEnd : string);
{

var _dateBegin : string = extractdelimitedword(_dateBegin_dateEnd,1,'/'); // extractdelimitedword('2020-05-05/2020-05-30',1,'/')
var _dateEnd   : string = extractdelimitedword(_dateBegin_dateEnd,2,'/');


  MyWriteLN('#Сначала надо импортировать модуль 1 раз для работы с EXCEL               ');
  MyWriteLN('# Если есть инет, то запускаем оболочку от имени админа и запускаем       ');
  MyWriteLN('# [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]::Tls11 -bor [System.Net.SecurityProtocolType]::Tls12 ');
  MyWriteLN('# Install-Module -Name ImportExcel                                                                                                            ');
  MyWriteLN('# Set-Executionpolicy -Scope CurrentUser -ExecutionPolicy ByPass                                                                              ');
  MyWriteLN('# Import-Module ImportExcel                                                                                                                   ');
  MyWriteLN('#                                                                                                                                             ');
  MyWriteLN('# если нет на машине инета, то идем https://www.powershellgallery.com/packages/ImportExcel/7.1.0 и качаем вручную все                         ');
  MyWriteLN('#                                                                                                                                             ');
  MyWriteLN('#name="test"                                                                                                                                  ');
  MyWriteLN('#Set-Executionpolicy -Scope CurrentUser -ExecutionPolicy ByPass                                                                               ');
  MyWriteLN('#Import-Module ImportExcel                                                                                                                    ');
  MyWriteLN('Get-ChildItem -Path $PSScriptRoot -Include @("*.ps1","*.log", "*.xls*") -Recurse | Where-Object -Property CreationTime -lt (Get-Date).AddDays(-8) | Remove-Item -Force -ErrorAction SilentlyContinue ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('$circuitserviceID="'+coCircuit_serviceID+'"                              ');
  MyWriteLN('$circuitendpointUrl="'+coCircuit_endpointUrlGetDocumentList+'"                          ');
  MyWriteLN('$circuitlogin="'+coCircuit_login+'"                                      ');
  MyWriteLN('$circuitpassword="'+coCircuit_password+'"                                ');
  MyWriteLN('$circuitapiKey="'+coCircuit_apiKey+'"                            ');
  MyWriteLN('$circuitissureId="'+coCircuit_issureId+'"                                ');
  MyWriteLN('$circuitsysLogin="'+coCircuit_sysLogin+'"                                 ');
  MyWriteLN('$circuitenterpriseGuid="'+coCircuit_enterpriseGuid+'"                     ');
  MyWriteLN('$circuitbusinessEntityGuid ="'+coCircuit_businessEntityGuid+'"            ');
  MyWriteLN('                                                                           ');
  MyWriteLN('$circuitCountTry           = '+coCircuit_CountTry+'                        ');
  MyWriteLN('$circuitPause              = '+coCircuit_Pause+'                           ');
  MyWriteLN('$fileLog =    "'+_MylogFile+'" ');
  MyWriteLN('$ReportPath = "'+_ExcelFileOut +'"                                         ');
  MyWriteLN('[String]$GlobError                                                                   ');
  MyWriteLN('$GlobError = ""                                                                      ');
  MyWriteLN('$RQST_GUID = "'+_OleGenerateGUID+'"                                                                                     ');
  MyWriteLN('$conStrinGal  = '''+GetConnString+'''');

  MyWriteLN('function Invoke-DatabaseQuery {                                                         ');
  MyWriteLN('        [CmdletBinding()]                                                               ');
  MyWriteLN('        param (                                                                         ');
  MyWriteLN('                [string]$connectionString,                                              ');
  MyWriteLN('                [string]$query,                                                         ');
  MyWriteLN('                [switch]$isSQLServer                                                    ');
  MyWriteLN('        )                                                                               ');
  MyWriteLN('        if ($isSQLServer) {                                                             ');
  MyWriteLN('                Write-Verbose ''in SQL Server mode''                                    ');
  MyWriteLN('                $connection = New-Object -TypeName System.Data.SqlClient.SqlConnection  ');
  MyWriteLN('        } else {                                                                        ');
  MyWriteLN('                Write-Verbose ''in OleDB mode''                                         ');
  MyWriteLN('                $connection = New-Object -TypeName System.Data.OleDb.OleDbConnection    ');
  MyWriteLN('        }                                                                               ');
  MyWriteLN('        $connection.ConnectionString = $connectionString                                ');
  MyWriteLN('        $command = $connection.CreateCommand()                                          ');
  MyWriteLN('        $command.CommandText = $query                                                   ');
  MyWriteLN('        $connection.Open()                                                              ');
  MyWriteLN('        $command.ExecuteNonQuery()                                                      ');
  MyWriteLN('        $connection.close()                                                             ');
  MyWriteLN('}                                                                                       ');

  MyWriteLN('Function GetDataFromWeb([xml]$fnXML, [string]$URL)                                                                                                                                                   ');
  MyWriteLN('{                                                                                                                                                                                                    ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('$headers = @{}                                                                                                                                                                                       ');
  MyWriteLN('$headers.add("SOAPAction","GetResponse")                                                                                                                                                             ');
  MyWriteLN('$headers.add("Accept","text/xml")                                                                                                                                                                    ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('$credentials = New-Object System.Management.Automation.PSCredential -ArgumentList @($circuitlogin,(ConvertTo-SecureString -String $circuitpassword -AsPlainText -Force))                             ');
  MyWriteLN('   try                                                                                                                                                                                               ');
  MyWriteLN('    {                                                                                                                                                                                                ');
  MyWriteLN('     Invoke-WebRequest -URI $URL -Headers $headers -Method Post -Body $fnXML -ContentType ''text/xml;charset="utf-8"'' -Credential $credentials -UseBasicParsing                                       ');
  MyWriteLN('    }                                                                                                                                                                                                ');
  MyWriteLN('    catch                                                                                                                                                                                            ');
  MyWriteLN('    {                                                                                                                                                                                                ');
  MyWriteLN('      $GlobError = $error[0]                                                                                                                                                                         ');
  MyWriteLN('      $null                                                                                                                                                                                          ');
  MyWriteLN('    }                                                                                                                                                                                                ');
  MyWriteLN('}                                                                                                                                                                                                    ');
  MyWriteLN('Function GetResponse()                                                                                                                                                                               ');
  MyWriteLN('{                                                                                                                                                                                                    ');
  MyWriteLN(' $template = @''                                                                                                                                                                                      ');
  MyWriteLN('<SOAP-ENV:Envelope xmlns:dt="http://api.vetrf.ru/schema/cdm/dictionary/v2"                                                                                                                           ');
  MyWriteLN('                   xmlns:bs="http://api.vetrf.ru/schema/cdm/base"                                                                                                                                    ');
  MyWriteLN('                   xmlns:merc="http://api.vetrf.ru/schema/cdm/mercury/g2b/applications/v2"                                                                                                           ');
  MyWriteLN('                   xmlns:apldef="http://api.vetrf.ru/schema/cdm/application/ws-definitions"                                                                                                          ');
  MyWriteLN('                   xmlns:apl="http://api.vetrf.ru/schema/cdm/application"                                                                                                                            ');
  MyWriteLN('                   xmlns:vd="http://api.vetrf.ru/schema/cdm/mercury/vet-document/v2"                                                                                                                 ');
  MyWriteLN('                   xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">                                                                                                                       ');
  MyWriteLN('  <SOAP-ENV:Header/>                                                                                                                                                                                 ');
  MyWriteLN('  <SOAP-ENV:Body>                                                                                                                                                                                    ');
  MyWriteLN('                    <apldef:submitApplicationRequest>                                                                                                                                                ');
  MyWriteLN('                      <apldef:apiKey>{0}</apldef:apiKey>                                                                                                                                             ');
  MyWriteLN('                        <apl:application>                                                                                                                                                            ');
  MyWriteLN('                            <apl:serviceId>{1}</apl:serviceId>                                                                                                                                       ');
  MyWriteLN('                            <apl:issuerId>{2}</apl:issuerId>                                                                                                                                         ');
  MyWriteLN('                            <apl:issueDate>2019-12-12T09:00:00+03:00</apl:issueDate>                                                                                                                 ');
  MyWriteLN('                            <apl:data>                                                                                                                                                               ');
  MyWriteLN('                                  <merc:getVetDocumentListRequest>                                                                                                                                   ');
  MyWriteLN('                                    <merc:localTransactionId>a110f03</merc:localTransactionId>                                                                                                       ');
  MyWriteLN('                                    <merc:initiator>                                                                                                                                                 ');
  MyWriteLN('                                      <vd:login>{3}</vd:login>                                                                                                                                       ');
  MyWriteLN('                                    </merc:initiator>                                                                                                                                                ');
  MyWriteLN('                                    <bs:listOptions>                                                                                                                                                 ');
  MyWriteLN('                                    <bs:count>1000</bs:count>                                                                                                                                        ');
  MyWriteLN('                                    </bs:listOptions>                                                                                                                                                ');
  MyWriteLN('                                     <vd:vetDocumentType>TRANSPORT</vd:vetDocumentType>                                                                                                              ');
  MyWriteLN('                                     <vd:issueDateInterval>                                                                                                                                          ');
  MyWriteLN('                                        <bs:beginDate>'+_dateBegin+'T00:00:00+03:00</bs:beginDate>                                                                                                       ');
  MyWriteLN('                                        <bs:endDate>'+_dateEnd+'T23:59:59+03:00</bs:endDate>                                                                                                           ');
  MyWriteLN('                                      </vd:issueDateInterval>                                                                                                                                        ');
  MyWriteLN('                                    <dt:enterpriseGuid>{4}</dt:enterpriseGuid>                                                                                                                       ');
  MyWriteLN('                                  </merc:getVetDocumentListRequest>                                                                                                                                  ');
  MyWriteLN('        </apl:data>                                                                                                                                                                                  ');
  MyWriteLN('      </apl:application>                                                                                                                                                                             ');
  MyWriteLN('    </apldef:submitApplicationRequest>                                                                                                                                                               ');
  MyWriteLN('  </SOAP-ENV:Body>                                                                                                                                                                                   ');
  MyWriteLN('</SOAP-ENV:Envelope>                                                                                                                                                                                 ');
  MyWriteLN('''@                                                                                                                                                                                                   ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('#            webRequest.Credentials = credentials;                                                                                                                                                   ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('$fnc_RqstBody = $template -f $circuitapiKey, $circuitserviceID, $circuitissureId, $circuitsysLogin, $circuitenterpriseGuid                                                                           ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('[xml] $XmlPrepare = $fnc_RqstBody                                                                                                                                                                    ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('$response = GetDataFromWeb -fnXML $XmlPrepare -URL $circuitendpointUrl                                                                                                                               ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('    If ( ($response.StatusCode -eq 200) -and ($response -ne $null))                                                                                                                                  ');
  MyWriteLN('    {                                                                                                                                                                                                ');
  MyWriteLN('     [xml] $XmlResponse = $response.content                                                                                                                                                          ');
  MyWriteLN('     #write-host $response.content                                                                                                                                                                   ');
  MyWriteLN('     $XmlResponse.GetElementsByTagName(''applicationId'').Item(0).FirstChild.data                                                                                                                      ');
  MyWriteLN('    }                                                                                                                                                                                                ');
  MyWriteLN('    else                                                                                                                                                                                             ');
  MyWriteLN('    {                                                                                                                                                                                                ');
  MyWriteLN('     $null                                                                                                                                                                                           ');
  MyWriteLN('    }                                                                                                                                                                                                ');
  MyWriteLN('}                                                                                                                                                                                                    ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('Function RecieveApplRqst([string]$requestAplId)                                                                                                                                                      ');
  MyWriteLN('{                                                                                                                                                                                                    ');
  MyWriteLN('$template=@''                                                                                                                                                                                         ');
  MyWriteLN('<SOAP-ENV:Envelope                                                                                                                                                                                   ');
  MyWriteLN('                    xmlns:dt="http://api.vetrf.ru/schema/cdm/dictionary/v2"                                                                                                                          ');
  MyWriteLN('                    xmlns:bs="http://api.vetrf.ru/schema/cdm/base"                                                                                                                                   ');
  MyWriteLN('                    xmlns:merc="http://api.vetrf.ru/schema/cdm/mercury/g2b/applications/v2"                                                                                                          ');
  MyWriteLN('                    xmlns:apldef="http://api.vetrf.ru/schema/cdm/application/ws-definitions"                                                                                                         ');
  MyWriteLN('                    xmlns:apl="http://api.vetrf.ru/schema/cdm/application"                                                                                                                           ');
  MyWriteLN('                    xmlns:vd="http://api.vetrf.ru/schema/cdm/mercury/vet-document/v2"                                                                                                                ');
  MyWriteLN('                    xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"                                                                                                                       ');
  MyWriteLN('                    xmlns:ws="http://api.vetrf.ru/schema/cdm/application/ws-definitions">                                                                                                            ');
  MyWriteLN('                <SOAP-ENV:Header/>                                                                                                                                                                   ');
  MyWriteLN('                <SOAP-ENV:Body>                                                                                                                                                                      ');
  MyWriteLN('                    <ws:receiveApplicationResultRequest>                                                                                                                                             ');
  MyWriteLN('                        <ws:apiKey>{0}</ws:apiKey>                                                                                                                                                   ');
  MyWriteLN('                        <ws:issuerId>{1}</ws:issuerId>                                                                                                                                               ');
  MyWriteLN('                        <ws:applicationId>{2}</ws:applicationId>                                                                                                                                     ');
  MyWriteLN('                    </ws:receiveApplicationResultRequest>                                                                                                                                            ');
  MyWriteLN('                </SOAP-ENV:Body>                                                                                                                                                                     ');
  MyWriteLN('</SOAP-ENV:Envelope>                                                                                                                                                                                 ');
  MyWriteLN('''@                                                                                                                                                                                                   ');
  MyWriteLN('#            webRequest.Credentials = credentials;                                                                                                                                                   ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('$fnc_RqstBody = $template -f $circuitapiKey, $circuitissureId, $requestAplId                                                                                                                         ');
  MyWriteLN('  $isContinue = $true                                                                                                                                                                                ');
  MyWriteLN('  $CountTRy = 0                                                                                                                                                                                      ');
  MyWriteLN('[xml] $XmlPrepare = $fnc_RqstBody                                                                                                                                                                    ');
  MyWriteLN('[xml] $result = $null                                                                                                                                                                                ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('  while ($isContinue -eq $true)                                                                                                                                                                      ');
  MyWriteLN('  {                                                                                                                                                                                                  ');
  MyWriteLN('    Wait-Event -Timeout $circuitPause                                                                                                                                                                ');
  MyWriteLN('   $CountTRy = $CountTRy + 1                                                                                                                                                                         ');
  MyWriteLN('   $response = GetDataFromWeb -fnXML $XmlPrepare -URL $circuitendpointUrl                                                                                                                            ');
  MyWriteLN('   [string] $currentStatus = ''''                                                                                                                                                                      ');
  MyWriteLN('    If ( ($response.StatusCode -eq 200) -and ($response -ne $null))                                                                                                                                  ');
  MyWriteLN('    {                                                                                                                                                                                                ');
  MyWriteLN('     [xml] $XmlResponse = $response.content                                                                                                                                                          ');
  MyWriteLN('     $currentStatus = $XmlResponse.GetElementsByTagName(''status'').Item(0).FirstChild.data                                                                                                            ');
  MyWriteLN('     if ($currentStatus -eq ''COMPLETED'')                                                                                                                                                             ');
  MyWriteLN('      {                                                                                                                                                                                              ');
  MyWriteLN('       $isContinue = $false                                                                                                                                                                          ');
  MyWriteLN('       $result = $XmlResponse                                                                                                                                                                        ');
  MyWriteLN('       # write-host $response.content                                                                                                                                                                ');
  MyWriteLN('      }                                                                                                                                                                                              ');
  MyWriteLN('    }                                                                                                                                                                                                ');
  MyWriteLN('    else                                                                                                                                                                                             ');
  MyWriteLN('    {                                                                                                                                                                                                ');
  MyWriteLN('     $null                                                                                                                                                                                           ');
  MyWriteLN('    }                                                                                                                                                                                                ');
  MyWriteLN('    #write-host "try number $CountTRy of $circuitCountTry | Curent state: $currentStatus"                                                                                                            ');
  MyWriteLN('    write-host "Запрос списка документов. Прослушивание ответа API. Запрос $CountTRy из $circuitCountTry. Получен ответ: $currentStatus"  -ForegroundColor Green                                     ');
  MyWriteLN('    if ($circuitCountTry -lt $CountTRy )                                                                                                                                                             ');
  MyWriteLN('     {                                                                                                                                                                                               ');
  MyWriteLN('      $isContinue = $false                                                                                                                                                                           ');
  MyWriteLN('     }                                                                                                                                                                                               ');
  MyWriteLN('  }                                                                                                                                                                                                  ');
  MyWriteLN(' $result                                                                                                                                                                                             ');
  MyWriteLN('}                                                                                                                                                                                                    ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('[xml]$DocumentList = $null                                                                                                                                                                           ');
  MyWriteLN(' write-host "Запрос списка документов. Отправка запроса"  -ForegroundColor Green                                                                                                                     ');
  MyWriteLN('$requestAplId = GetResponse                                                                                                                                                                          ');
  MyWriteLN('if ($GlobError -eq '''')                                                                                                                                                                               ');
  MyWriteLN('{                                                                                                                                                                                                    ');
  MyWriteLN(' write-host "Запрос списка документов. Прослушивание ответа API"  -ForegroundColor Green                                                                                                             ');
  MyWriteLN(' $DocumentList = RecieveApplRqst($requestAplId)                                                                                                                                                      ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('}                                                                                                                                                                                                    ');
  MyWriteLN('else                                                                                                                                                                                                 ');
  MyWriteLN('{                                                                                                                                                                                                    ');
  MyWriteLN(' $GlobError                                                                                                                                                                                          ');
  MyWriteLN('}                                                                                                                                                                                                    ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('#$DocumentList.Envelope.Body.receiveApplicationResultResponse.application.result.getVetDocumentListResponse.vetDocumentList                                                                          ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('if ($DocumentList -ne $null)                                                                                                                                                                         ');
  MyWriteLN('{                                                                                                                                                                                                    ');
  MyWriteLN('[System.Collections.ArrayList] $FinalReport = @();                                                                                                                                                   ');
  MyWriteLN('    #$stockEntryElementList.save("C:\Users\lapus\OneDrive\Desktop\_WORK\stockEntryElementList.xml")                                                                                                  ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('    #$stockEntryElementList.GetElementsByTagName(''application'')                                                                                                                                      ');
  MyWriteLN('    #$stockEntryElementList.GetElementsByTagName(''result'')                                                                                                                                           ');
  MyWriteLN('   write-host "Запрос списка документов. Разбор XML ответа"  -ForegroundColor Green                                                                                                                  ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('#    $ns = new-object Xml.XmlNamespaceManager $stockEntryElementList.NameTable                                                                                                                       ');
  MyWriteLN('#    $ns.AddNamespace("soap", $stockEntryElementList.DocumentElement.NamespaceURI)                                                                                                                   ');
  MyWriteLN('#    $ns.AddNamespace("vd", $stockEntryElementList.DocumentElement.NamespaceURI)                                                                                                                     ');
  MyWriteLN('#    $ns.AddNamespace("ns1", $stockEntryElementList.DocumentElement.NamespaceURI)                                                                                                                    ');
  MyWriteLN('#    $ns.AddNamespace("dt", $stockEntryElementList.DocumentElement.NamespaceURI)                                                                                                                     ');
  MyWriteLN('#    $ns.AddNamespace("bs", $stockEntryElementList.DocumentElement.NamespaceURI)                                                                                                                     ');
  MyWriteLN('#    $stockEntryElementList.SelectNodes("//soap:Envelope/soap:Body", $ns)                                                                                                                            ');
  MyWriteLN('#    $stockEntryElementList.SelectNodes("//soap:Envelope/soap:Body/ns1:getStockEntryListResponse", $ns)                                                                                              ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('    # пошлда спецификация                                                                                                                                                                            ');
  MyWriteLN('    foreach($Document in $DocumentList.Envelope.Body.receiveApplicationResultResponse.application.result.getVetDocumentListResponse.vetDocumentList.vetDocument)                                     ');
  MyWriteLN('    {                                                                                                                                                                                                ');
  MyWriteLN('      $item = New-Object PSObject                                                                                                                                                                    ');
  MyWriteLN('     # для вставки в основную таблицу                                                                                                                                                                ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListAPPLICATIONID+'" -Value $DocumentList.Envelope.Body.receiveApplicationResultResponse.application.applicationId.tostring() #APPLICATIONID            ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListREQUESTSTATUS+'" -Value $DocumentList.Envelope.Body.receiveApplicationResultResponse.application.status.ToString()        #REQUESTSTATUS            ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListUUID+'" -value $Document.uuid       # UUID ЭВСД                                                                                                ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListDataEVSD+'" -value $Document.issueDate  # дата оформления ЭВСД                                                                          ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListSTATUS+'" -value $Document.vetDStatus # Статус                                                                                                      ');
  MyWriteLN('                                                                                                                                                                                                     ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListBusinessEntityGuid+'" -value $Document.certifiedConsignment.consignee.businessEntity.guid # consignee.businessEntity.guid  ');// щначением атрибута VETIS_BusinessEntity, выводим НЕТОЧНО + "Наименование клиента"
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListEnterpriseGuid+'" -value $Document.certifiedConsignment.consignee.enterprise.guid     # consignee.enterprise.guid      ');// внешнего атрибута VETIS_Enterprise совпадает
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListTrasporttype+'" -value $Document.certifiedConsignment.transportInfo.transportType   # Тип транспортного средства    ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListCar+'" -value $Document.certifiedConsignment.transportInfo.transportNumber.vehicleNumber # Автомобиль                      ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListGlobalID+'" -value $Document.certifiedConsignment.batch.productItem.globalID        # Наименование продукции            ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListProductName+'" -value $Document.certifiedConsignment.batch.productItem.name        # Наименование продукции            ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListVolume+'" -value $Document.certifiedConsignment.batch.volume                  # Объем                                              ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListKatEd+'" -value $Document.certifiedConsignment.batch.unit.guid               # Единица объема                            ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('      $YEAR  = $Document.certifiedConsignment.batch.dateOfProduction.firstDate.year                                                                                                ');
  MyWriteLN('      $MONTH = $Document.certifiedConsignment.batch.dateOfProduction.firstDate.month                                                                                               ');
  MyWriteLN('      $DAY   = $Document.certifiedConsignment.batch.dateOfProduction.firstDate.day                                                                                                 ');
  MyWriteLN('      $DataProizv = Get-Date -Year $YEAR -Month $MONTH -Day $DAY -Hour 0 -Minute 0 -Second 0                                                                                       ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListDataProizv+'" -value $($DataProizv.tostring("yyyy-MM-dd")) # Дата производства                                             ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('      $YEAR  = $Document.certifiedConsignment.batch.expiryDate.firstDate.year         # Срок годности                                                                              ');
  MyWriteLN('      $MONTH = $Document.certifiedConsignment.batch.expiryDate.firstDate.month        # Срок годности                                                                              ');
  MyWriteLN('      $DAY   = $Document.certifiedConsignment.batch.expiryDate.firstDate.day          # Срок годности                                                                              ');
  MyWriteLN('      $DataProizv = Get-Date -Year $YEAR -Month $MONTH -Day $DAY -Hour 0 -Minute 0 -Second 0                                                                                       ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListSrokGodn+'" -value $($DataProizv.tostring("yyyy-MM-dd")) # Срок годности                                                     ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('      $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListBatchID+'" -value $Document.certifiedConsignment.batch.batchID       # batchID                                                    ');
  MyWriteLN('      foreach($package in $Document.certifiedConsignment.batch.packageList.package)                                                                                                ');
  MyWriteLN('       {                                                                                                                                                                           ');
  MyWriteLN('       # в название колонки/описателя будем добавлять тип документа, перебирать тут из кейсом не хочу, лучше в коде на випе                                                        ');
  MyWriteLN('        $nameField = "'+coPS1_GetDocListLevel+'"+$Package.level                                                                           ');
  MyWriteLN('        $item | Add-Member -type NoteProperty -Name $nameField -value $Package.level  # $Package.level*                                           ');
  MyWriteLN('        $nameField = "'+coPS1_GetDocListPACKINGTYPEID+'"+$Package.level                                                                           ');
  MyWriteLN('        $item | Add-Member -type NoteProperty -Name $nameField -value $package.packingType.globalID  # $Package.level*                                           ');
  MyWriteLN('        $nameField = "'+coPS1_GetDocListQuantity+'"+$Package.level                                                                           ');
  MyWriteLN('        $item | Add-Member -type NoteProperty -Name $nameField -value $package.quantity  # $Package.level*                                           ');
  MyWriteLN('            foreach($productMark in  $package.productMarks)                                                                                                                        ');
  MyWriteLN('             {                                                                                                                                                                     ');
  MyWriteLN('              if ($ProductMark.Class -eq "EAN13")                                                                                                                                 ');
  MyWriteLN('               {                                                                                                                                                                   ');
  MyWriteLN('                $nameField = "'+coPS1_GetDocListEAN13+'"+$Package.level                                                                           ');
  MyWriteLN('                $item | Add-Member -type NoteProperty -Name $nameField -value $productMark.''#text''  # "EAN13"                                                                   ');
  MyWriteLN('               }                                                                                                                                                                   ');
  MyWriteLN('              if ($ProductMark.Class -eq "EAN128")                                                                                                                                ');
  MyWriteLN('               {                                                                                                                                                                   ');
  MyWriteLN('                $nameField = "'+coPS1_GetDocListEAN128+'"+$Package.level                                                                           ');
  MyWriteLN('                $item | Add-Member -type NoteProperty -Name $nameField -value $productMark.''#text''  # "EAN28"                                                                   ');
  MyWriteLN('               }                                                                                                                                                                   ');
  MyWriteLN('              if ($ProductMark.Class -eq "SSCC")                                                                                                                                ');
  MyWriteLN('               {                                                                                                                                                                   ');
  MyWriteLN('                $nameField = "'+coPS1_GetDocListSSCC+'"+$Package.level                                                                           ');
  MyWriteLN('                $item | Add-Member -type NoteProperty -Name $nameField -value $productMark.''#text''  # "EAN28"                                                                   ');
  MyWriteLN('               }                                                                                                                                                                   ');

  MyWriteLN('             }                                                                                                                                                                     ');


/*  MyWriteLN('        if ($Package.level -eq 2) # Уровень        2                                                                                                                                     ');
  MyWriteLN('         {                                                                                                                                                                         ');
  MyWriteLN('          $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListLevel_2+'" -value $package.level                 # "Уровень упаковки(2)"                                          ');
  MyWriteLN('          $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListPACKINGTYPEID_2+'" -value $package.packingType.globalID  # "Идентификатор упаковки(2)"                              ');
  MyWriteLN('          $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListQuantity_2+'" -value $package.quantity              # "Количество штук"                                                  ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('            foreach($productMark in  $package.productMarks)                                                                                                                        ');
  MyWriteLN('             {                                                                                                                                                                     ');
  MyWriteLN('              if ($ProductMark.Class -eq "EAN13")                                                                                                                                 ');
  MyWriteLN('               {                                                                                                                                                                   ');
  MyWriteLN('                #$productMark.class                                                                                                                                                ');
  MyWriteLN('                $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListEAN13_2+'" -value $productMark.''#text''  #"EAN13(2)"                                                                    ');
  MyWriteLN('               }                                                                                                                                                                   ');
  MyWriteLN('             }                                                                                                                                                                     ');
  MyWriteLN('         }                                                                                                                                                                         ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('        if ($Package.level -eq 4) # Уровень        4                                                                                                                                     ');
  MyWriteLN('         {                                                                                                                                                                         ');
  MyWriteLN('          $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListLevel_4+'" -value $package.level                 # "Уровень упаковки(4)"                                          ');
  MyWriteLN('          $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListPACKINGTYPEID_4+'" -value $package.packingType.globalID  # "Идентификатор упаковки(4)"                              ');
  MyWriteLN('          $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListQuantity_4+'" -value $package.quantity              # "Количество коробок"                                            ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('            foreach($productMark in  $package.productMarks)                                                                                                                        ');
  MyWriteLN('             {                                                                                                                                                                     ');
  MyWriteLN('              if ($ProductMark.Class -eq "EAN13")                                                                                                                                 ');
  MyWriteLN('               {                                                                                                                                                                   ');
  MyWriteLN('                #$productMark.class                                                                                                                                                ');
  MyWriteLN('                $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListEAN13_4+'" -value $productMark.''#text''  # "EAN13(4)"                                                                   ');
  MyWriteLN('               }                                                                                                                                                                   ');
  MyWriteLN('              if ($ProductMark.Class -eq "EAN128")                                                                                                                                ');
  MyWriteLN('               {                                                                                                                                                                   ');
  MyWriteLN('                $item | Add-Member -type NoteProperty -Name "'+coPS1_GetDocListEAN128_4+'" -value $productMark.''#text'' # "EAN128(4)"                                                                  ');
  MyWriteLN('               }                                                                                                                                                                   ');
  MyWriteLN('             }                                                                                                                                                                     ');
  MyWriteLN('         }                                                                                                                                                                         ');
  MyWriteLN('                                                                                                                                                                                   ');
*/
  MyWriteLN('       }                                                                                                                                                                           ');

  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('    #  $Document.authentication                                                                                                                                                    ');
  MyWriteLN('    #  $FinalReport +=,$item                                                                                                                                                       ');
  MyWriteLN('    [string]$nameField = ""                                                                                                                                                        ');
  MyWriteLN('      foreach($referencedDocument in $Document.referencedDocument)                                                                                                                 ');
  MyWriteLN('       {                                                                                                                                                                           ');
  MyWriteLN('       # в название колонки/описателя будем добавлять тип документа, перебирать тут из кейсом не хочу, лучше в коде на випе                                                        ');
  MyWriteLN('        $nameField = "'+coPS1_GetDocListReferencedDocumentIssueNumber+'"+$referencedDocument.issueNumber                                                                                              ');
  MyWriteLN('        $item | Add-Member -type NoteProperty -Name $nameField -value $referencedDocument.issueNumber  # referencedDocumentIssueNumber_*                                           ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('        $nameField = "'+coPS1_GetDocListReferencedDocumentissueDate+'"+$referencedDocument.issueNumber                                                                                                ');
  MyWriteLN('        $item | Add-Member -type NoteProperty -Name $nameField -value $referencedDocument.issueDate    # referencedDocumentissueDate_*                                             ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('        $nameField = "'+coPS1_GetDocListReferencedDocumentissuetype+'"+$referencedDocument.issueNumber                                                                                                ');
  MyWriteLN('        $item | Add-Member -type NoteProperty -Name $nameField -value $referencedDocument.type         # referencedDocumentissuetype_*                                             ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('        $nameField = "'+coPS1_GetDocListReferencedDocumentissuerelationshipType+'"+$referencedDocument.issueNumber                                                                                   ');
  MyWriteLN('        $item | Add-Member -type NoteProperty -Name $nameField -value $referencedDocument.relationshipType # referencedDocumentissuerelationshipType_*                             ');
  MyWriteLN('       }                                                                                                                                                                           ');
  MyWriteLN('     foreach($statusChange in $Document.statusChange)                                                                                                                              ');
  MyWriteLN('     {                                                                                                                                                                             ');
  MyWriteLN('       # в название колонки/описателя будем добавлять статус, перебирать тут из кейсом не хочу, лучше в коде на випе                                                               ');
  MyWriteLN('       $nameField = "'+coPS1_GetDocListDocumentstatusChangeStatus+'"+$statusChange.status                                                                                                            ');
  MyWriteLN('       $item | Add-Member -type NoteProperty -Name $nameField -value $statusChange.status              # DocumentstatusChange.status_*                                             ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('       $nameField = "'+coPS1_GetDocListDocumentstatusChangeSpecifiedPerson+'"+$statusChange.status                                                                                               ');
  MyWriteLN('       $item | Add-Member -type NoteProperty -Name $nameField -value $statusChange.specifiedPerson.fio # DocumentstatusChange.specifiedPerson.fio_*                                ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('       $nameField = "'+coPS1_GetDocListDocumentstatusChangeActualDateTime+'"+$statusChange.status                                                                                                    ');
  MyWriteLN('       $item | Add-Member -type NoteProperty -Name $nameField -value $statusChange.actualDateTime      # DocumentstatusChange.actualDateTime_                                      ');
  MyWriteLN('     }                                                                                                                                                                             ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('     write-host $Document.issueDate -ForegroundColor Cyan                                                                                        ');
  MyWriteLN('     Add-Content -Path $fileLog -Value $($(Get-Date).ToString("yyyy-MM-dd HH:mm:ss") + " "+ $Document.certifiedConsignment.batch.productItem.name) -Encoding Oem                   ');
  MyWriteLN('     $FinalReport +=,$item                                                                                                                                                         ');
  MyWriteLN('    }                                                                                                                                                                              ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('  write-host "Запрос стока. Выгрузка в EXCEL" -ForegroundColor Green                                                                                                               ');
  MyWriteLN(' $ReportPath = $ReportPath                                                                                                                                                         ');
  MyWriteLN(' $FinalReport | Export-Excel -Path $ReportPath -AutoSize -WorksheetName "GetStockList"                                                                                             ');
  MyWriteLN('                                                                                                                                                                                   ');
  MyWriteLN('[string]$sqlQuery = "" ');
  MyWriteLN(' [int]$npp = 1                                                                                                                                                                     ');
  MyWriteLN(' write-host "Запрос документов. Запись запроса " -ForegroundColor Green                                                                                                       ');
  MyWriteLN(' foreach($item in $FinalReport)                                                                                                                                                    ');
  MyWriteLN('  {                                                                                                                                                                                ');
  MyWriteLN('   if([math]::Truncate($npp/23) -eq $npp/23) ');
  MyWriteLN('    {                                       ');
  MyWriteLN('     write-host "Запись в буферную таблицу полученных результатов" -ForegroundColor Cyan       ');
  MyWriteLN('     $res = Invoke-DatabaseQuery -connectionString $conStrinGal -query $sqlQuery -isSQLServer ');
  MyWriteLN('     $sqlQuery = "" ');
  MyWriteLN('    }                                       ');

  MyWriteLN('   if([math]::Truncate($npp/7) -eq $npp/7)                                                                                                                                         ');
  MyWriteLN('    {                                                                                                                                                                              ');
  MyWriteLN('     write-host "Запись запроса " $npp.tostring() " из " $FinalReport.Count.toString()  -ForegroundColor Cyan                                                            ');
  MyWriteLN('     Add-Content -Path $fileLog -Value $($(Get-Date).ToString("yyyy-MM-dd HH:mm:ss") + " Запись в буферную таблицу" +$npp.tostring() +" из " +$FinalReport.Count.toString()) -Encoding Oem ');
  MyWriteLN('    }                                                                                                                                                                                      ');
  MyWriteLN('   foreach( $property in $item.psobject.properties.name )                                                                                                                                  ');
  MyWriteLN('    {                                                                                                                                                                                      ');
  MyWriteLN('      if ($item.$property -eq $null)                                                                                                                                                       ');
  MyWriteLN('        {                                                                                                                                                                                  ');
  MyWriteLN('         $itemproperty = ""                                                                                                                                                                ');
  MyWriteLN('        }                                                                                                                                                                                  ');
  MyWriteLN('        else                                                                                                                                                                               ');
  MyWriteLN('         {                                                                                                                                                                                 ');
  MyWriteLN('          $itemproperty = $item.$property                                                                                                                                                  ');
  MyWriteLN('         }                                                                                                                                                                                 ');
  MyWriteLN('      $sqlQuery = $sqlQuery + ''Insert v$ATL_RQSTAPIVALUES (f$RQST_GUID, f$RSQT_PROVIDER, f$NROW, f$COLUMNNAME, f$VALUE)    ');
  MyWriteLN('                   values (''''''+$RQST_GUID+'''''',''''''+$circuitserviceID+'''''',''+$npp.tostring()+'',''''''+$property.Replace("''","''''")+'''''',''''''+$itemproperty.Replace("''","''''")+'''''') ');
  MyWriteLN('            ''                                                                                                                                                                               ');
  MyWriteLN('    }                                                                                                                                                                                      ');
  MyWriteLN('    $npp = $npp + 1                                                                                                                                                                        ');
  MyWriteLN('  }                                                                                                                                                                                        ');
  MyWriteLN('   write-host "Запись в буферную таблицу полученных результатов" -ForegroundColor Cyan       ');
  MyWriteLN('      $res = Invoke-DatabaseQuery -connectionString $conStrinGal -query $sqlQuery -isSQLServer                                                                                             ');
  MyWriteLN('      $sqlQuery = "" ');

  MyWriteLN(' Add-Content -Path $fileLog -Value $($(Get-Date).ToString("yyyy-MM-dd HH:mm:ss") + " Запись в буферную таблицу" +$($npp-1).tostring() +" из " +$FinalReport.Count.toString()) -Encoding Oem ');
  MyWriteLN('}                                                                                                                                                                                           ');


}
Function GetRequestToAPIVetis_GetDocumentList(_dateBegin_dateEnd : string): boolean;
{
  #BodyProcedureGetRqst(GetDocumentList,_dateBegin_dateEnd)

}
